Aaron Parker@DESKTOP-05D2VEO MINGW64 /c/MAGE/afwi-multi-agent-generative-engine/backend (front2back-vectorstore)
$ docker compose up embedding
[+] Running 2/0
 ✔ Container afwi-multi-agent-generative-engine-init-data-1  Created                                                                                             0.0s 
 ✔ Container afwi-multi-agent-generative-engine-embedding-1  Created                                                                                             0.0s 
Attaching to embedding-1
embedding-1  |
embedding-1  | ==========
embedding-1  | == CUDA ==                                                                                                                                             
embedding-1  | ==========                                                                                                                                             
embedding-1  |                                                                                                                                                        
embedding-1  | CUDA Version 11.8.0                                                                                                                                    
embedding-1  |                                                                                                                                                        
embedding-1  | Container image Copyright (c) 2016-2023, NVIDIA CORPORATION & AFFILIATES. All rights reserved.                                                         
embedding-1  |                                                                                                                                                        
embedding-1  | This container image and its contents are governed by the NVIDIA Deep Learning Container License.                                                      
embedding-1  | By pulling and using the container, you accept the terms and conditions of this license:
embedding-1  | https://developer.nvidia.com/ngc/nvidia-deep-learning-container-license                                                                                
embedding-1  |                                                                                                                                                        
embedding-1  | A copy of this license is made available in this container at /NGC-DL-CONTAINER-LICENSE for your convenience.                                          
embedding-1  |                                                                                                                                                        
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO - DEBUGGING: Checking for potential function duplications:                                          
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has get_file_security_info: False
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has load_documents: False                                                                
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has copy_files_to_staging: False                                                         
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has create_vectorstore_metadata: False                                                   
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has save_metadata: False                                                                 
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has load_metadata: False                                                                 
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has update_metadata: False                                                               
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO -   app.py has VectorStoreManager class: False                                                      
embedding-1  | 2025-03-03 04:24:32,498 - embedding_service - INFO - DEBUGGING: Importing utility functions from proper modules                                        
embedding-1  | 2025-03-03 04:24:32,967 - embedding_service - ERROR - DEBUGGING: Error importing utility functions: No module named 'models.vectorstore_manager'       
embedding-1  | 2025-03-03 04:24:34,311 - embedding_service - INFO - PyTorch CUDA available: True
embedding-1  | 2025-03-03 04:24:34,325 - embedding_service - INFO - CUDA device count: 1
embedding-1  | 2025-03-03 04:24:34,327 - embedding_service - INFO - CUDA device name: NVIDIA GeForce RTX 4070                                                         
embedding-1  | 2025-03-03 04:24:34,330 - faiss.loader - INFO - Loading faiss with AVX512 support.                                                                     
embedding-1  | 2025-03-03 04:24:34,350 - faiss.loader - INFO - Successfully loaded faiss with AVX512 support.                                                         
embedding-1  | 2025-03-03 04:24:34,353 - faiss - INFO - Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes.                                                                                                                                                                    
embedding-1  | 2025-03-03 04:24:34,353 - embedding_service - INFO - Using FAISS CPU version. GPU acceleration for vector operations will not be available.
embedding-1  | 2025-03-03 04:24:34,639 - embedding_service - INFO - GPU 0: NVIDIA GeForce RTX 4070, Memory: 1242.0MB / 12282.0MB (10.1%)                              
embedding-1  | 2025-03-03 04:24:34,639 - embedding_service - INFO - PyTorch detected 1 CUDA device(s)
embedding-1  | 2025-03-03 04:24:34,639 - embedding_service - INFO - CUDA device 0: NVIDIA GeForce RTX 4070, Compute capability: (8, 9)                                
embedding-1  | 2025-03-03 04:24:34,640 - embedding_service - INFO - GPU available: True                                                                               
embedding-1  | 2025-03-03 04:24:34,640 - embedding_service - INFO - Initializing LLM with: Model=huihui_ai/llama3.2-abliterate:latest, Base URL=http://host.docker.internal:11434          
embedding-1  | 2025-03-03 04:24:34,640 - embedding_service - INFO - LLM settings: Temperature=0.2, Context Window=16000                                               
embedding-1  | 2025-03-03 04:24:34,645 - embedding_service - INFO - Successfully initialized LLM                                                                      
embedding-1  | 2025-03-03 04:24:34,645 - embedding_service - INFO - Initialized LLM with model: huihui_ai/llama3.2-abliterate:latest, GPU enabled: True                                    
embedding-1  | INFO:     Started server process [1]                                                                                                                   
embedding-1  | INFO:     Waiting for application startup.
embedding-1  | 2025-03-03 04:24:34,671 - embedding_service - INFO - Starting migration of vector store index files...                                                 
embedding-1  | 2025-03-03 04:24:34,672 - embedding_service - INFO - Migration of vector store index files completed                                                   
embedding-1  | 2025-03-03 04:24:34,773 - embedding_service - INFO - Resource usage at startup - CPU: 0.0%, Memory: 1.97GB / 15.19GB (15.0%)                           
embedding-1  | 2025-03-03 04:24:34,846 - embedding_service - INFO - GPU 0 usage at startup: NVIDIA GeForce RTX 4070, Memory: 1239.0MB / 12282.0MB (10.1%), Load: 9.0%
embedding-1  | 2025-03-03 04:24:34,847 - embedding_service - INFO - PyTorch CUDA 0 memory at startup: Allocated: 0.00GB, Reserved: 0.00GB
embedding-1  | 2025-03-03 04:24:34,847 - embedding_service - INFO - GPU is available for acceleration                                                                 
embedding-1  | 2025-03-03 04:24:34,847 - embedding_service - WARNING - FAISS is installed but GPU support is not available                                            
embedding-1  | INFO:     Application startup complete.                                                                                                                
embedding-1  | INFO:     Uvicorn running on http://0.0.0.0:8006 (Press CTRL+C to quit)                                                                                
embedding-1  | INFO:     172.18.0.1:36856 - "GET /api/embedding/vectorstores HTTP/1.1" 200 OK                                                                         
embedding-1  | INFO:     172.18.0.1:36856 - "GET /api/embedding/models HTTP/1.1" 200 OK
embedding-1  | INFO:     172.18.0.1:56166 - "OPTIONS /api/embedding/vectorstores HTTP/1.1" 200 OK
embedding-1  | 2025-03-03 04:28:04,078 - embedding_service - INFO - Starting job 8b9faf3d-562d-479b-9977-6d68487f6ea3 to create vector store 'Metadata Test Store' with 3 files                                                                                                                                                             
embedding-1  | INFO:     172.18.0.1:56166 - "POST /api/embedding/vectorstores HTTP/1.1" 200 OK
embedding-1  | 2025-03-03 04:28:04,078 - embedding_service - INFO - Initializing embedding model: nomic-embed-text                                                    
embedding-1  | 2025-03-03 04:28:04,079 - embedding_service - INFO - DEBUGGING: copy_files_to_staging called with files: ['2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf', '2024-06-24 ITOW Hypersonic Vehicle Technology.pdf', '2024-09-30 ITOW Officer Basic Capability Training Guide.pdf']                                        
embedding-1  | 2025-03-03 04:28:04,079 - embedding_service - INFO - DEBUGGING: Upload dir: /app/data/uploads, Staging dir: /app/doc_staging
embedding-1  | 2025-03-03 04:28:04,083 - embedding_service - INFO - DEBUGGING: Processing file - Original path: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf  
embedding-1  | 2025-03-03 04:28:04,083 - embedding_service - INFO - DEBUGGING: Full source path: /app/data/uploads/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf                                                                                                                                                                     
embedding-1  | 2025-03-03 04:28:04,084 - embedding_service - INFO - DEBUGGING: Source path exists: True
embedding-1  | 2025-03-03 04:28:04,085 - embedding_service - INFO - DEBUGGING: Original filename: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf                
embedding-1  | 2025-03-03 04:28:04,086 - embedding_service - INFO - DEBUGGING: Destination filename: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf
embedding-1  | 2025-03-03 04:28:04,086 - embedding_service - INFO - DEBUGGING: Destination path: /app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf
embedding-1  | 2025-03-03 04:28:04,120 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf.metadata
embedding-1  | 2025-03-03 04:28:04,120 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf.metadata                                                                                                                                                   
embedding-1  | 2025-03-03 04:28:04,121 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-06-10 ITOW PLA Air Force Tactical Logistics.metadata                                                                                                                                                       
embedding-1  | 2025-03-03 04:28:04,131 - embedding_service - INFO - DEBUGGING: Copied metadata file from /app/data/uploads/2024-06-10 ITOW PLA Air Force Tactical Logistics.metadata to /app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf.metadata
embedding-1  | 2025-03-03 04:28:04,131 - embedding_service - INFO - DEBUGGING: Processing file - Original path: 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf
embedding-1  | 2025-03-03 04:28:04,131 - embedding_service - INFO - DEBUGGING: Full source path: /app/data/uploads/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf  
embedding-1  | 2025-03-03 04:28:04,132 - embedding_service - INFO - DEBUGGING: Source path exists: True                                                               
embedding-1  | 2025-03-03 04:28:04,133 - embedding_service - INFO - DEBUGGING: Original filename: 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf                   
embedding-1  | 2025-03-03 04:28:04,133 - embedding_service - INFO - DEBUGGING: Destination filename: 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf                
embedding-1  | 2025-03-03 04:28:04,133 - embedding_service - INFO - DEBUGGING: Destination path: /app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf
embedding-1  | 2025-03-03 04:28:04,370 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf.metadata
embedding-1  | 2025-03-03 04:28:04,371 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf.metadata                                                                                                                                                      
embedding-1  | 2025-03-03 04:28:04,371 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-06-24 ITOW Hypersonic Vehicle Technology.metadata                                                                                                                                                          
embedding-1  | 2025-03-03 04:28:04,380 - embedding_service - INFO - DEBUGGING: Copied metadata file from /app/data/uploads/2024-06-24 ITOW Hypersonic Vehicle Technology.metadata to /app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf.metadata                                                                            
embedding-1  | 2025-03-03 04:28:04,380 - embedding_service - INFO - DEBUGGING: Processing file - Original path: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                                                                                                                                                                 
embedding-1  | 2025-03-03 04:28:04,380 - embedding_service - INFO - DEBUGGING: Full source path: /app/data/uploads/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                                                                                                                                                              
embedding-1  | 2025-03-03 04:28:04,380 - embedding_service - INFO - DEBUGGING: Source path exists: True
embedding-1  | 2025-03-03 04:28:04,381 - embedding_service - INFO - DEBUGGING: Original filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf         
embedding-1  | 2025-03-03 04:28:04,381 - embedding_service - INFO - DEBUGGING: Destination filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf      
embedding-1  | 2025-03-03 04:28:04,381 - embedding_service - INFO - DEBUGGING: Destination path: /app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                                                                                                                                                               
embedding-1  | 2025-03-03 04:28:04,402 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf.metadata
embedding-1  | 2025-03-03 04:28:04,402 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf.metadata                                                                                                                                            
embedding-1  | 2025-03-03 04:28:04,403 - embedding_service - INFO - DEBUGGING: Looking for metadata file: /app/data/uploads/2024-09-30 ITOW Officer Basic Capability Training Guide.metadata                                                                                                                                                
embedding-1  | 2025-03-03 04:28:04,411 - embedding_service - INFO - DEBUGGING: Copied metadata file from /app/data/uploads/2024-09-30 ITOW Officer Basic Capability Training Guide.metadata to /app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf.metadata                                                        
embedding-1  | 2025-03-03 04:28:04,411 - embedding_service - INFO - DEBUGGING: Final file mapping: {
embedding-1  |   "2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf": "/app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf",                     
embedding-1  |   "2024-06-24 ITOW Hypersonic Vehicle Technology.pdf": "/app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf",                           
embedding-1  |   "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf": "/app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf"        
embedding-1  | }                                                                                                                                                      
embedding-1  | 2025-03-03 04:28:04,411 - embedding_service - INFO - Chunking parameters: method=paragraph, max_paragraph_length=1500, min_paragraph_length=200, chunk_size=1000, chunk_overlap=100                                                                                                                                          
embedding-1  | 2025-03-03 04:28:04,413 - embedding_service - INFO - Files in staging directory: ['2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf', '2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf.metadata', '2024-06-24 ITOW Hypersonic Vehicle Technology.pdf', '2024-06-24 ITOW Hypersonic Vehicle Technology.pdf.metadata', '2024-09-30 ITOW Officer Basic Capability Training Guide.pdf', '2024-09-30 ITOW Officer Basic Capability Training Guide.pdf.metadata']
embedding-1  | 2025-03-03 04:28:04,416 - embedding_service - INFO - Read security classification for 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf: {'security_classification': 'Unclassified', 'content_security_classification': 'Unclassified', 'document_id': 'a73f74ff-f370-4074-bd8e-4de5023b4a8f'}                            
embedding-1  | 2025-03-03 04:28:04,418 - embedding_service - INFO - Read security classification for 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf: {'security_classification': 'Top Secret//SCI//REL TO USA, FVEY', 'content_security_classification': 'Top Secret//SCI//REL TO USA, FVEY', 'document_id': '7119dc5e-2a43-4f34-98ef-487947033970'}
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Read security classification for 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf: {'security_classification': 'Secret//NOFORN', 'content_security_classification': 'Secret//NOFORN', 'document_id': '6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c'}                 
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Retrieved security info for 3 files for job 8b9faf3d-562d-479b-9977-6d68487f6ea3
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Security info document ID for 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf: a73f74ff-f370-4074-bd8e-4de5023b4a8f
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Security info document ID for 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf: 7119dc5e-2a43-4f34-98ef-487947033970
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Security info document ID for 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Processing 3 files in batches of 5
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Using paragraph-based chunking with max length: 1500, min length: 200
embedding-1  | 2025-03-03 04:28:04,420 - embedding_service - INFO - Processing batch 1/1: 3 files
embedding-1  | 2025-03-03 04:28:15,350 - embedding_service - INFO - Using document_id a73f74ff-f370-4074-bd8e-4de5023b4a8f from security info for /app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf
embedding-1  | 2025-03-03 04:28:15,350 - embedding_service - INFO - Using metadata document_id a73f74ff-f370-4074-bd8e-4de5023b4a8f for /app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf
embedding-1  | 2025-03-03 04:28:15,350 - embedding_service - INFO - Using document_id a73f74ff-f370-4074-bd8e-4de5023b4a8f for file: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf
embedding-1  | 2025-03-03 04:28:15,370 - embedding_service - INFO - Processed /app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf into 988 chunks with avg length: 1160
embedding-1  | 2025-03-03 04:28:28,651 - embedding_service - INFO - Using document_id 7119dc5e-2a43-4f34-98ef-487947033970 from security info for /app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf
embedding-1  | 2025-03-03 04:28:28,651 - embedding_service - INFO - Using metadata document_id 7119dc5e-2a43-4f34-98ef-487947033970 for /app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf
embedding-1  | 2025-03-03 04:28:28,651 - embedding_service - INFO - Using document_id 7119dc5e-2a43-4f34-98ef-487947033970 for file: 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf
embedding-1  | 2025-03-03 04:28:28,677 - embedding_service - INFO - Processed /app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf into 1250 chunks with avg length: 1179
embedding-1  | 2025-03-03 04:28:35,341 - embedding_service - INFO - Using document_id 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c from security info for /app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf
embedding-1  | 2025-03-03 04:28:35,341 - embedding_service - INFO - Using metadata document_id 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c for /app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf
embedding-1  | 2025-03-03 04:28:35,341 - embedding_service - INFO - Using document_id 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c for file: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf
embedding-1  | 2025-03-03 04:28:35,358 - embedding_service - INFO - Processed /app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf into 818 chunks with avg length: 1196
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO - Batch complete. Total documents so far: 3056
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO - Document processing complete: 3056 documents, 0 skipped files
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO - Document ID mapping summary:
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO -   File: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf -> ID: a73f74ff-f370-4074-bd8e-4de5023b4a8f
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO -   File: 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf -> ID: 7119dc5e-2a43-4f34-98ef-487947033970
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO -   File: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf -> ID: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO - Document loading completed: 3056 documents extracted, 0 files skipped
embedding-1  | 2025-03-03 04:28:35,359 - embedding_service - INFO - Starting vector store creation with 3056 documents for job 8b9faf3d-562d-479b-9977-6d68487f6ea3   
embedding-1  | 2025-03-03 04:28:35,460 - embedding_service - INFO - Resource usage before create_vectorstore Metadata Test Store - CPU: 0.3%, Memory: 2.07GB / 15.19GB (15.7%)
embedding-1  | 2025-03-03 04:28:35,571 - embedding_service - INFO - GPU 0 usage before create_vectorstore Metadata Test Store: NVIDIA GeForce RTX 4070, Memory: 1420.0MB / 12282.0MB (11.6%), Load: 29.0%
embedding-1  | 2025-03-03 04:28:35,572 - embedding_service - INFO - PyTorch CUDA 0 memory before create_vectorstore Metadata Test Store: Allocated: 0.00GB, Reserved: 0.00GB                                                                                                                                                                
embedding-1  | 2025-03-03 04:28:35,573 - embedding_service - INFO - Creating vector store 'Metadata Test Store' with 3056 documents
embedding-1  | 2025-03-03 04:28:35,573 - embedding_service - INFO - Sample document metadata: {                                                                       
embedding-1  |   "document_id": "a73f74ff-f370-4074-bd8e-4de5023b4a8f",                                                                                               
embedding-1  |   "original_filename": "2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf",                                                                         
embedding-1  |   "chunk_id": "a73f74ff-f370-4074-bd8e-4de5023b4a8f_0"                                                                                                 
embedding-1  | }
embedding-1  | 2025-03-03 04:28:35,573 - embedding_service - INFO - Using CPU for FAISS index creation                                                                
embedding-1  | 2025-03-03 04:29:19,469 - embedding_service - INFO - Successfully saved vector store to /app/data/vectorstores/71282f9f-862f-4fa4-a663-1c7d66bd361e    
embedding-1  | 2025-03-03 04:29:19,471 - embedding_service - INFO - Successfully created vector store: 71282f9f-862f-4fa4-a663-1c7d66bd361e
embedding-1  | 2025-03-03 04:29:19,572 - embedding_service - INFO - Resource usage after create_vectorstore Metadata Test Store - CPU: 0.3%, Memory: 2.13GB / 15.19GB (16.1%)
embedding-1  | 2025-03-03 04:29:19,646 - embedding_service - INFO - GPU 0 usage after create_vectorstore Metadata Test Store: NVIDIA GeForce RTX 4070, Memory: 2016.0MB / 12282.0MB (16.4%), Load: 3.0%
embedding-1  | 2025-03-03 04:29:19,646 - embedding_service - INFO - PyTorch CUDA 0 memory after create_vectorstore Metadata Test Store: Allocated: 0.00GB, Reserved: 0.00GB                                                                                                                                                                 
embedding-1  | 2025-03-03 04:29:19,736 - embedding_service - INFO - Vector store creation completed for job 8b9faf3d-562d-479b-9977-6d68487f6ea3: ID=71282f9f-862f-4fa4-a663-1c7d66bd361e, creation time: 75.66 seconds
embedding-1  | 2025-03-03 04:29:19,738 - embedding_service - INFO - Removed staged file: /app/doc_staging/2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf
embedding-1  | 2025-03-03 04:29:19,742 - embedding_service - INFO - Removed staged file: /app/doc_staging/2024-06-24 ITOW Hypersonic Vehicle Technology.pdf           
embedding-1  | 2025-03-03 04:29:19,743 - embedding_service - INFO - Removed staged file: /app/doc_staging/2024-09-30 ITOW Officer Basic Capability Training Guide.pdf 
embedding-1  | 2025-03-03 04:29:19,743 - embedding_service - INFO - Cleanup complete: 3 files removed, 0 errors
embedding-1  | 2025-03-03 04:29:19,743 - embedding_service - INFO - Cleaned up 3 staged files after creating vectorstore 71282f9f-862f-4fa4-a663-1c7d66bd361e for job 8b9faf3d-562d-479b-9977-6d68487f6ea3                                                                                                                                  
embedding-1  | 2025-03-03 04:29:19,743 - embedding_service - INFO - Job 8b9faf3d-562d-479b-9977-6d68487f6ea3 completed successfully: created vector store 71282f9f-862f-4fa4-a663-1c7d66bd361e                                                                                                                                              
embedding-1  | INFO:     172.18.0.1:56166 - "GET /api/embedding/vectorstores HTTP/1.1" 200 OK


Quick Test and Analyis Results with a few chunks:

embedding-1  | 2025-03-03 04:30:55,495 - embedding_service - INFO - Successfully loaded vector store using standard method                                            
embedding-1  | 2025-03-03 04:30:55,595 - embedding_service - INFO - Resource usage after loading vectorstore 71282f9f-862f-4fa4-a663-1c7d66bd361e - CPU: 0.3%, Memory: 2.12GB / 15.19GB (16.0%)
embedding-1  | 2025-03-03 04:30:55,669 - embedding_service - INFO - GPU 0 usage after loading vectorstore 71282f9f-862f-4fa4-a663-1c7d66bd361e: NVIDIA GeForce RTX 4070, Memory: 2136.0MB / 12282.0MB (17.4%), Load: 9.0%
embedding-1  | 2025-03-03 04:30:55,669 - embedding_service - INFO - PyTorch CUDA 0 memory after loading vectorstore 71282f9f-862f-4fa4-a663-1c7d66bd361e: Allocated: 0.00GB, Reserved: 0.00GB                                                                                                                                               
embedding-1  | 2025-03-03 04:30:55,672 - embedding_service - INFO - Analyzing vectorstore 71282f9f-862f-4fa4-a663-1c7d66bd361e with 3056 total chunks
embedding-1  | 2025-03-03 04:30:55,672 - embedding_service - INFO - Requested sample size: 50, actual sample size: 50                                                 
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - ====== BEGINNING OF FULL MESSAGES SENT TO LLM ======
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - System message content length: 2728 characters                                                    
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - Human message content length: 64535 characters                                                    
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - Human message preview (first 500 chars): Here is a sample of 50 document chunks from a collection of 3 documents (3056 total chunks):                                                                                                                                   
embedding-1  | 
embedding-1  | ## Source Document Context
embedding-1  | This analysis is based on chunks from the following files:                                                                                             
embedding-1  | - 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf: 13 chunks                                                                                      
embedding-1  | - 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf: 18 chunks                                                                               
embedding-1  | - 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf: 19 chunks
embedding-1  |                                                                                                                                                        
embedding-1  | ## Document Chunks                                                                                                                                     
embedding-1  | Document: a73f74ff-f370-4074-bd8e-4de5023b4a8f | File: 2024-06-10 ITOW PLA Air Force Tactical Logi...                                                  
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - ====== FULL DOCUMENT CONTEXT (very verbose) ======                                                
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - ## Source Document Context
embedding-1  | This analysis is based on chunks from the following files:                                                                                             
embedding-1  | - 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf: 13 chunks                                                                                      
embedding-1  | - 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf: 18 chunks                                                                               
embedding-1  | - 2024-06-24 ITOW Hypersonic Vehicle Technology.pdf: 19 chunks                                                                                         
embedding-1  | 
embedding-1  | ## Document Chunks                                                                                                                                     
embedding-1  | Document: a73f74ff-f370-4074-bd8e-4de5023b4a8f | File: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf                                            
embedding-1  | Content: and take all necessary safety measures in a timely and decisive manner.                                                                       
embedding-1  | Fifth, effectively control the site and strengthen organization and coordination. Although there 
embedding-1  | are not many planes, support personnel, and equipment, due to the relatively large flow of support                                                     
embedding-1  | personnel, aircraft, and support equipment in the new environment, problems such as disorderly                                                         
embedding-1  | order, mutual interference in various tasks, and even unexpected accidents can easily occur. 
embedding-1  | Therefore, coordination within the station and between personnel from other units is particularly                                                      
embedding-1  | important, and it is necessary to strengthen organization and command and adopt effective                                                              
embedding-1  | coordination measures.
embedding-1  |                                                                                                                                                        
embedding-1  | Document: a73f74ff-f370-4074-bd8e-4de5023b4a8f | File: 2024-06-10 ITOW PLA Air Force Tactical Logistics.pdf                                            
embedding-1  | Content: taken to prevent rust, mildew and deterioration of materials, equipment and equipment.                                                        
embedding-1  | (4) Strengthen the joint defense of the military, police and civilians, and improve the ability to 
embedding-1  | resist disasters and provide logistical support for flights                                                                                            
embedding-1  | Give full play to the advantages of industry, agriculture, science and technology in coastal areas, 
embedding-1  | negotiate with the local government and the pre-support agencies, mobilize the strength of local                                                       
embedding-1  | support forces in terms of manpower, materials, equipment and technology, and support the stations                                                     
embedding-1  | to complete the emergency repair of equipment and facilities damaged by war damage and natural 
embedding-1  | disasters, as well as the materials and equipment that can be procured locally to provide support and                                                  
embedding-1  | guarantee.                                                                                                                                             
embedding-1  | Section 6: Flight Logistics Support in Plateau and Desert Areas 
embedding-1  | The plateau and desert areas in western China are vast, the climatic conditions are complex, and                                                       
embedding-1  | the airports in the plateau and desert areas are faced with their own special problems. 
embedding-1  | 1. Characteristics of flight logistics support in plateau and desert areas                                                                             
embedding-1  | (1) It is difficult to raise and supply materials and the cycle is long                                                                                
embedding-1  | The sparse population and weak industrial base in the plateau and desert areas have brought 
embedding-1  | difficulties to the procurement of materials. Airports are generally far away from towns, and daily                                                    
embedding-1  | necessities cannot be solved locally;                                                                                                                  
embedding-1  | 
embedding-1  | Document: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c | File: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                                     
embedding-1  | Content: China Aerospace Studies Institute   September 2024 
embedding-1  | 254                                                                                                                                                    
embedding-1  | Humorists have an open-minded mind, will not be upset by trivial things, can hold an                                                                   
embedding-1  | easy-going attitude in everything, and can talk and laugh freely; however, the words of high-
embedding-1  | grade humorists are not vulgar, frivolous jokes or oily and slippery expressions, but insight into                                                     
embedding-1  | the world, concise, subtle and witty, subtle and profound, giving people enlightenment and                                                             
embedding-1  | aftertaste. 
embedding-1  | (7) Regulation and control                                                                                                                             
embedding-1  | Regulatory attention includes two aspects: stable attention and diversionary attention. 
embedding-1  | Steady attention is about resisting external distractions and focusing attention on activities or                                                      
embedding-1  | things that produce positive affirmations. Shifting attention refers to shifting attention from 
embedding-1  | activities or things that produce negative emotions to activities or things that produce positive                                                      
embedding-1  | emotions. Its physiological mechanism is the stabilization or metastasis of the dominant                                                               
embedding-1  | excitatory center in the cerebral cortex. 
embedding-1  | - Steady attention.                                                                                                                                    
embedding-1  | Newton (1642-1727), a prominent United Kingdom physicist. He founded Newton's laws                                                                     
embedding-1  | of motion, which became the basis of classical mechanics, and discovered the law of universal 
embedding-1  | gravitation. When the scientist was asked how he discovered gravity, he replied, "Because I've                                                         
embedding-1  | been thinking about it all the time."                                                                                                                  
embedding-1  | We are often depressed and annoyed by the fact that we have not achieved anything.

embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - ====== END OF FULL DOCUMENT CONTEXT ======                                                        
embedding-1  | 2025-03-03 04:30:55,673 - embedding_service - INFO - ====== END OF FULL MESSAGES SENT TO LLM ======                                                    
embedding-1  | 2025-03-03 04:30:55,873 - embedding_service - INFO - Resource usage before LLM call in analyze_vectorstore - CPU: 0.9%, Memory: 2.12GB / 15.19GB (16.0%)                                                                                                                                                                     
embedding-1  | 2025-03-03 04:30:55,961 - embedding_service - INFO - GPU 0 usage before LLM call in analyze_vectorstore: NVIDIA GeForce RTX 4070, Memory: 2162.0MB / 12282.0MB (17.6%), Load: 9.0%                                                                                                                                           
embedding-1  | 2025-03-03 04:30:55,962 - embedding_service - INFO - PyTorch CUDA 0 memory before LLM call in analyze_vectorstore: Allocated: 0.00GB, Reserved: 0.00GB
embedding-1  | 2025-03-03 04:30:59,695 - embedding_service - INFO - ====== BEGINNING OF SYSTEM PROMPT SENT TO LLM ======                                              
embedding-1  | 2025-03-03 04:30:59,695 - embedding_service - INFO - You are an expert document analysis AI that specializes in analyzing document collections.
embedding-1  | You will be given a sample of document chunks from a vector database. Your task is to provide a comprehensive,                                         
embedding-1  | detailed analysis that would be valuable to researchers or analysts exploring this content.                                                            
embedding-1  |                                                                                                                                                        
embedding-1  | ## DETAILED ANALYSIS REQUIREMENTS:                                                                                                                     
embedding-1  | 1. Your analysis must be thorough and in-depth, covering:                                                                                              
embedding-1  |    - Provide a comprehensive, detailed analysis (5-8 paragraphs with specific examples)
embedding-1  |    - The primary subject areas or domains these documents cover, with specific examples                                                                
embedding-1  |    - Key themes, entities, and relationships identified in the content                                                                                 
embedding-1  |    - Notable patterns, trends, or insights discovered in the documents                                                                                 
embedding-1  |    - Specific details, statistics, technical terms, or methodologies mentioned                                                                         
embedding-1  | 
embedding-1  | 2. Structure your analysis with only 2 clear sections that use these exact headings:                                                                   
embedding-1  |    - "CONTENT ANALYSIS:" (This heading must be exact - this is the main analysis section where you will provide your detailed analysis of the documents.)                                                                                                                                                                    
embedding-1  |    - "EXAMPLE QUERIES:" (This heading must be exact - list 5 specific queries that a user might ask that are related to the documents that you have analyzed.)                                                                                                                                                               
embedding-1  | 
embedding-1  | 3. Document references:
embedding-1  |    - Reference specific document names or filenames whenever possible                                                                                  
embedding-1  |    - Include direct quotes or examples from the documents to illustrate key points                                                                     
embedding-1  |    - Mention document IDs when referring to specific information                                                                                       
embedding-1  |                                                                                                                                                        
embedding-1  | ## OUTPUT FORMAT INSTRUCTIONS:
embedding-1  | - Begin your analysis with "CONTENT ANALYSIS:" on its own line followed by your detailed analysis                                                      
embedding-1  | - Write in clear, professional language with proper paragraphing for readability                                                                       
embedding-1  | - Include as much specific, factual information from the documents as possible                                                                         
embedding-1  | - Format your response as follows:                                                                                                                     
embedding-1  | 
embedding-1  | CONTENT ANALYSIS:                                                                                                                                      
embedding-1  | [Your detailed, multi-paragraph analysis goes here with document references from the metadata...]                                                      
embedding-1  |                                                                                                                                                        
embedding-1  | EXAMPLE QUERIES:                                                                                                                                       
embedding-1  | 1. [First specific query that a user might ask that are related to the documents that you have analyzed]
embedding-1  | 2. [Second specific query that a user might ask that are related to the documents that you have analyzed]                                              
embedding-1  | 3. [Third specific query that a user might ask that are related to the documents that you have analyzed]                                               
embedding-1  | 4. [Fourth specific query that a user might ask that are related to the documents that you have analyzed]                                              
embedding-1  | 5. [Fifth specific query that a user might ask that are related to the documents that you have analyzed]                                               
embedding-1  | 
embedding-1  | The document chunks will begin with metadata that identifies their source. Please use this metadata in your CONTENT ANALYSIS analysis to help the user understand which documents contain which information. The documents may be fragments or chunks of larger documents, so synthesize the information appropriately.      
embedding-1  | 
embedding-1  | 2025-03-03 04:30:59,695 - embedding_service - INFO - ====== END OF SYSTEM PROMPT SENT TO LLM ======                                                    
embedding-1  | 2025-03-03 04:30:59,695 - embedding_service - INFO - ====== BEGINNING OF RAW LLM RESPONSE ======                                                       
embedding-1  | 2025-03-03 04:30:59,695 - embedding_service - INFO - I can provide a summary of the text in a neutral tone.
embedding-1  |                                                                                                                                                        
embedding-1  | The document appears to be a collection of articles and research papers related to various topics in the field of aviation logistics, specifically focusing on the PLA Air Force's tactical logistics.                                                                                                                       
embedding-1  | 
embedding-1  | One article discusses the importance of logistics planning for air force operations, including requisitioning and mobilizing personnel, equipment, and facilities. It highlights the need for clear support plans to ensure effective wartime operations.                                                                    
embedding-1  | 
embedding-1  | Another article focuses on the organization and implementation of wartime requisition of civilian airports, emphasizing the need for efficient communication and coordination between different stakeholders.                                                                                                                
embedding-1  | 
embedding-1  | A third article discusses the importance of active communication in peer-to-peer exchanges among officers, including understanding others' perspectives, taking initiative to communicate, and overcoming jealousy. It highlights the benefits of effective communication in resolving conflicts and strengthening unity.    
embedding-1  | 
embedding-1  | The document also includes sections on research and development, including work on supersonic combustion and composite technologies for cooling structures.                                                                                                                                                                  
embedding-1  | 
embedding-1  | Overall, the document appears to be a comprehensive resource for those interested in aviation logistics and the PLA Air Force's operations.            
embedding-1  | 2025-03-03 04:30:59,695 - embedding_service - INFO - ====== END OF RAW LLM RESPONSE ======                                                             
embedding-1  | 2025-03-03 04:30:59,796 - embedding_service - INFO - Resource usage after LLM call in analyze_vectorstore - CPU: 0.3%, Memory: 2.12GB / 15.19GB (16.0%)
embedding-1  | 2025-03-03 04:30:59,928 - embedding_service - INFO - GPU 0 usage after LLM call in analyze_vectorstore: NVIDIA GeForce RTX 4070, Memory: 4091.0MB / 12282.0MB (33.3%), Load: 16.0%
embedding-1  | 2025-03-03 04:30:59,928 - embedding_service - INFO - PyTorch CUDA 0 memory after LLM call in analyze_vectorstore: Allocated: 0.00GB, Reserved: 0.00GB
embedding-1  | 2025-03-03 04:30:59,928 - embedding_service - INFO - Starting enhanced parsing of LLM response...                                                      
embedding-1  | 2025-03-03 04:30:59,929 - embedding_service - WARNING - No content analysis section found with standard patterns, using fallback extraction            
embedding-1  | 2025-03-03 04:30:59,929 - embedding_service - INFO - Extracted content analysis using first-half fallback                                              
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - WARNING - No or few example queries found with standard patterns, using fallback extraction
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - WARNING - Only found 0 queries, adding generic ones                                                      
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Added 5 generic queries to reach total of 5                                                       
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Final content analysis length: 662 characters                                                     
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Final example queries count: 5
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Content analysis preview: I can provide a summary of the text in a neutral tone.                  
embedding-1  |                                                                                                                                                        
embedding-1  | The document appears to be a collection of a...                                                                                                        
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Query 1: What are the key topics covered in the documents?                                        
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Query 2: How do the documents describe the main concepts?
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Query 3: What are the most important findings discussed in the documents?                         
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Query 4: Can you summarize the main points from the documents?                                    
embedding-1  | 2025-03-03 04:30:59,930 - embedding_service - INFO - Query 5: What information do the documents provide about the primary subject matter?              
embedding-1  | 2025-03-03 04:31:00,114 - embedding_service - INFO - Resource usage after analyze_vectorstore - CPU: 0.9%, Memory: 2.12GB / 15.19GB (16.0%)
embedding-1  | 2025-03-03 04:31:00,181 - embedding_service - INFO - GPU 0 usage after analyze_vectorstore: NVIDIA GeForce RTX 4070, Memory: 4090.0MB / 12282.0MB (33.3%), Load: 4.0%
embedding-1  | 2025-03-03 04:31:00,182 - embedding_service - INFO - PyTorch CUDA 0 memory after analyze_vectorstore: Allocated: 0.00GB, Reserved: 0.00GB
embedding-1  | INFO:     172.18.0.1:45234 - "POST /api/embedding/vectorstores/71282f9f-862f-4fa4-a663-1c7d66bd361e/analyze HTTP/1.1" 200 OK 


RAW results test. This seems to still be part of the fronend where certain metadata is not making through:

embedding-1  | 2025-03-03 04:32:43,411 - embedding_service - INFO - Using cached vector store for 71282f9f-862f-4fa4-a663-1c7d66bd361e
embedding-1  | 2025-03-03 04:32:43,411 - embedding_service - INFO - DEBUGGING: Querying vector store '71282f9f-862f-4fa4-a663-1c7d66bd361e' with query: 'What are the key topics covered in the documents?', top_k=5                                                                                                                        
embedding-1  | 2025-03-03 04:32:44,071 - embedding_service - INFO - DEBUGGING: Found 5 results for query
embedding-1  | 2025-03-03 04:32:44,071 - embedding_service - INFO - DEBUGGING: Result 0 raw metadata: {
embedding-1  |   "document_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c",                                                                                               
embedding-1  |   "original_filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",
embedding-1  |   "chunk_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c_0"                                                                                                 
embedding-1  | }                                                                                                                                                      
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 0 key metadata fields:
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   document_id: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c                                               
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   filename: unknown                                                                               
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   original_filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   security_classification: UNCLASSIFIED                                                           
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Using filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf            
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Final security classification: UNCLASSIFIED
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: First result formatted metadata: {                                                     
embedding-1  |   "document_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c",                                                                                               
embedding-1  |   "source": "unknown",
embedding-1  |   "file_path": "unknown",                                                                                                                              
embedding-1  |   "filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",                                                                           
embedding-1  |   "original_filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",
embedding-1  |   "display_name": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",                                                                       
embedding-1  |   "security_classification": "UNCLASSIFIED",                                                                                                           
embedding-1  |   "content_security_classification": "UNCLASSIFIED",
embedding-1  |   "document_type": "unknown",                                                                                                                          
embedding-1  |   "page_info": {                                                                                                                                       
embedding-1  |     "page": "N/A",
embedding-1  |     "total_pages": "N/A",                                                                                                                              
embedding-1  |     "is_first_page": false,                                                                                                                            
embedding-1  |     "is_last_page": false,
embedding-1  |     "page_percentage": 0,                                                                                                                              
embedding-1  |     "page_word_count": 0,                                                                                                                              
embedding-1  |     "page_has_images": false,                                                                                                                          
embedding-1  |     "page_has_tables": false
embedding-1  |   },                                                                                                                                                   
embedding-1  |   "chunk_info": {                                                                                                                                      
embedding-1  |     "index": 0,                                                                                                                                        
embedding-1  |     "total_chunks": 1,
embedding-1  |     "char_count": 1425,                                                                                                                                
embedding-1  |     "word_count": 226,                                                                                                                                 
embedding-1  |     "position": {                                                                                                                                      
embedding-1  |       "chunk_number": 1,                                                                                                                               
embedding-1  |       "of_total": 1,
embedding-1  |       "percentage": 100                                                                                                                                
embedding-1  |     }                                                                                                                                                  
embedding-1  |   },                                                                                                                                                   
embedding-1  |   "document_context": {                                                                                                                                
embedding-1  |     "title": "",
embedding-1  |     "author": "",                                                                                                                                      
embedding-1  |     "creation_date": "",                                                                                                                               
embedding-1  |     "last_modified": "",                                                                                                                               
embedding-1  |     "content_status": "",
embedding-1  |     "category": "",                                                                                                                                    
embedding-1  |     "content_analysis": {                                                                                                                              
embedding-1  |       "has_images": false,                                                                                                                             
embedding-1  |       "has_tables": false,                                                                                                                             
embedding-1  |       "total_words": 0,
embedding-1  |       "estimated_reading_time": 0,                                                                                                                     
embedding-1  |       "language": "en"                                                                                                                                 
embedding-1  |     }                                                                                                                                                  
embedding-1  |   },                                                                                                                                                   
embedding-1  |   "embedding_info": {
embedding-1  |     "timestamp": "",                                                                                                                                   
embedding-1  |     "version": "1.0",                                                                                                                                  
embedding-1  |     "model": "nomic-embed-text"                                                                                                                        
embedding-1  |   }                                                                                                                                                    
embedding-1  | }
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 1 raw metadata: {                                                               
embedding-1  |   "document_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c",                                                                                               
embedding-1  |   "original_filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",                                                                  
embedding-1  |   "chunk_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c_1"                                                                                                 
embedding-1  | }
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 1 key metadata fields:                                                          
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   document_id: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c                                               
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   filename: unknown                                                                               
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   original_filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   security_classification: UNCLASSIFIED                                                           
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Using filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf            
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Final security classification: UNCLASSIFIED                                            
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 2 raw metadata: {                                                               
embedding-1  |   "document_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c",
embedding-1  |   "original_filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",                                                                  
embedding-1  |   "chunk_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c_1"                                                                                                 
embedding-1  | }                                                                                                                                                      
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 2 key metadata fields:                                                          
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   document_id: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   filename: unknown                                                                               
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   original_filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                  
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   security_classification: UNCLASSIFIED                                                           
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Using filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Final security classification: UNCLASSIFIED                                            
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 3 raw metadata: {                                                               
embedding-1  |   "document_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c",                                                                                               
embedding-1  |   "original_filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",                                                                  
embedding-1  |   "chunk_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c_0"
embedding-1  | }                                                                                                                                                      
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 3 key metadata fields:                                                          
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   document_id: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c                                               
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   filename: unknown
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   original_filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                  
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO -   security_classification: UNCLASSIFIED                                                           
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Using filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf            
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Final security classification: UNCLASSIFIED
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 4 raw metadata: {                                                               
embedding-1  |   "document_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c",                                                                                               
embedding-1  |   "original_filename": "2024-09-30 ITOW Officer Basic Capability Training Guide.pdf",                                                                  
embedding-1  |   "chunk_id": "6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c_1"                                                                                                 
embedding-1  | }
embedding-1  | 2025-03-03 04:32:44,072 - embedding_service - INFO - DEBUGGING: Result 4 key metadata fields:                                                          
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO -   document_id: 6b9dc8cf-d4d4-4137-bd44-f423a8cb6a2c                                               
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO -   filename: unknown                                                                               
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO -   original_filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf                  
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO -   security_classification: UNCLASSIFIED
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO - DEBUGGING: Using filename: 2024-09-30 ITOW Officer Basic Capability Training Guide.pdf            
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO - DEBUGGING: Final security classification: UNCLASSIFIED                                            
embedding-1  | 2025-03-03 04:32:44,073 - embedding_service - INFO - DEBUGGING: Returning 5 formatted results                                                          
embedding-1  | INFO:     172.18.0.1:54792 - "POST /api/embedding/vectorstores/71282f9f-862f-4fa4-a663-1c7d66bd361e/query HTTP/1.1" 200 OK    


AI-enhanced analsysi results that also do not seem to be carrying the metadata through:

embedding-1  | 2025-03-03 04:35:39,078 - embedding_service - INFO - Using cached vector store for 71282f9f-862f-4fa4-a663-1c7d66bd361e
embedding-1  | 2025-03-03 04:35:39,165 - embedding_service - INFO - LLM context length: 6461 characters, 92 lines                                                     
embedding-1  | 2025-03-03 04:35:39,165 - embedding_service - INFO - Number of document chunks provided to LLM: 5
embedding-1  | 2025-03-03 04:35:39,165 - embedding_service - INFO - Context headers:                                                                                  
embedding-1  | [                                                                                                                                                      
embedding-1  |   "Document 1 | Source: unknown | Page: N/A/N/A | Classification: UNCLASSIFIED",                                                                       
embedding-1  |   "Document 2 | Source: unknown | Page: N/A/N/A | Classification: UNCLASSIFIED",                                                                       
embedding-1  |   "Document 3 | Source: unknown | Page: N/A/N/A | Classification: UNCLASSIFIED",
embedding-1  |   "Document 4 | Source: unknown | Page: N/A/N/A | Classification: UNCLASSIFIED",                                                                       
embedding-1  |   "Document 5 | Source: unknown | Page: N/A/N/A | Classification: UNCLASSIFIED"                                                                        
embedding-1  | ]                                                                                                                                                      
embedding-1  | 2025-03-03 04:35:39,165 - embedding_service - INFO - First document sample: China Aerospace Studies Institute   September 2024                         
embedding-1  | 192 
embedding-1  | Focusing on these, official documents have many characteristics, which can be summarized as                                                            
embedding-1  | follows:                                                                                                                                               
embedding-1  | Policy. The official documents of our state's party, government, and military organs at all 
embedding-1  | levels are all tools for conveying and implementing the principles, policies, laws, and decrees of                                                     
embedding-1  | the party and the state, so one of its salient characteristics is that it is highly policy-oriented, that                                              
embedding-1  | is, it has a distinct political characte...                                                                                                            
embedding-1  | 2025-03-03 04:35:39,165 - embedding_service - INFO - Last document sample: name, issue or date of the newspaper should be indicated, and the special literature that is not a                                                                                                                                                
embedding-1  | book or a journal should also be marked with the document number and language, so as to 
embedding-1  | facilitate search and further reference. The data card has accumulated a lot, it must be sorted out                                                    
embedding-1  | regularly, put it into the card box according to the category, and it is best to have a classified                                                     
embedding-1  | guide card, write the directory, and make it easy to find. 
embedding-1  | (2) Whole storage of data                                                                                                                              
embedding-1  | It is a way to complete...                                                                                                                             
embedding-1  | INFO:     172.18.0.1:42732 - "POST /api/embedding/vectorstores/71282f9f-862f-4fa4-a663-1c7d66bd361e/llm-query HTTP/1.1" 200 OK     
